<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÛŒÚ©ØªÙ‡â€ŒÚ¯ÙˆÛŒ ÙØ§Ø±Ø³ÛŒ - Ù¾Ø§ÛŒÙ‡ Ú†Ù‡Ø§Ø±Ù…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazir', 'B Nazanin', 'Tahoma', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            animation: gradient 15s ease infinite;
            background-size: 400% 400%;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ */
        .loading-section {
            text-align: center;
            padding: 80px 20px;
        }

        .loading-icon {
            font-size: 6em;
            margin-bottom: 30px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-title {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .loading-desc {
            font-size: 1.3em;
            color: #666;
            line-height: 1.8;
        }

        /* ØµÙØ­Ù‡ ÙÙ‡Ø±Ø³Øª */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .emoji-decoration {
            font-size: 3em;
            margin: 20px 0;
        }

        .main-title {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: bounce2 2s infinite;
        }

        @keyframes bounce2 {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: 1.8em;
            color: #764ba2;
            font-weight: bold;
        }

        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .lesson-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 40px 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 4px solid #ff9a76;
            text-align: center;
        }

        .lesson-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .lesson-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .lesson-title {
            font-size: 2em;
            color: #5a3825;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .lesson-desc {
            font-size: 1.2em;
            color: #8b5a3c;
        }

        /* ØµÙØ­Ù‡ Ø¯ÛŒÚ©ØªÙ‡ */
        .lesson-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            border: 3px solid #84d6d1;
        }

        .lesson-header h2 {
            font-size: 2.2em;
            color: #2c5f5d;
            margin-bottom: 5px;
        }

        .lesson-number {
            font-size: 1.3em;
            color: #4a7c7a;
        }

        .progress-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-label {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 35px;
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50, #8bc34a, #cddc39);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }

        .repeat-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 25px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .repeat-selector {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .repeat-selector label {
            font-size: 1.2em;
            color: #333;
            font-weight: bold;
            margin-left: 15px;
        }

        .repeat-selector select {
            padding: 10px 20px;
            font-size: 1.2em;
            border-radius: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #333;
            cursor: pointer;
            font-family: 'Vazir', 'B Nazanin', 'Tahoma', sans-serif;
        }

        .listening-indicator {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 50px 30px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 4px solid #ff9a76;
        }

        .listening-emoji {
            font-size: 5em;
            margin-bottom: 15px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .listening-text {
            font-size: 2.5em;
            color: #5a3825;
            font-weight: bold;
        }

        .controls-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .controls-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .main-controls {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .navigation-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .control-btn {
            padding: 18px 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-first { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .btn-prev { background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); }
        .btn-play { background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%); }
        .btn-next { background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%); }
        .btn-last { background: linear-gradient(135deg, #9c27b0 0%, #e91e63 100%); }
        .btn-flashcard { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #5a3825; border: 3px solid #ff9a76; }
        .btn-menu { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        .volume-section {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: center;
        }

        .volume-icon {
            font-size: 2em;
        }

        .volume-slider {
            flex: 1;
            max-width: 300px;
            height: 10px;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            min-width: 60px;
        }

        .flashcard-header {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            border: 3px solid #ff9a76;
        }

        .flashcard-header h2 {
            font-size: 2.2em;
            color: #5a3825;
            margin-bottom: 10px;
        }

        .flashcard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .flashcard {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 35px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            font-size: 1.8em;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            color: #2c5f5d;
            border: 3px solid #84d6d1;
        }

        .flashcard:hover {
            transform: translateY(-10px) scale(1.05) rotate(2deg);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .status-message {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .status-message.info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 3px solid #6cb2c7;
        }

        .status-message.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 3px solid #5cb85c;
        }

        .status-message.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 3px solid #f1c40f;
        }

        .status-message.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 3px solid #e74c3c;
        }

        .back-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #9c27b0 0%, #e91e63 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 20px auto 0;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);
        }

        .error-section {
            text-align: center;
            padding: 60px 20px;
        }

        .error-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .error-title {
            font-size: 2em;
            color: #e74c3c;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .error-desc {
            font-size: 1.2em;
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .error-details {
            background: #f8d7da;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e74c3c;
            margin-top: 20px;
            text-align: right;
        }

        .error-details h4 {
            color: #721c24;
            margin-bottom: 10px;
        }

        .error-details ul {
            color: #721c24;
            list-style-position: inside;
        }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            .main-title { font-size: 2em; }
            .subtitle { font-size: 1.3em; }
            .main-controls { grid-template-columns: repeat(3, 1fr); }
            .navigation-controls { grid-template-columns: 1fr; }
            .control-btn { font-size: 1em; padding: 15px 10px; }
            .volume-control { flex-direction: column; }
            .volume-slider { max-width: 100%; }
            .listening-text { font-size: 1.8em; }
        }

        @media (max-width: 480px) {
            .main-controls { grid-template-columns: 1fr 1fr; }
            .lesson-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ -->
        <div class="page active" id="loadingPage">
            <div class="loading-section">
                <div class="loading-icon">â³</div>
                <h1 class="loading-title">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</h1>
                <p class="loading-desc">Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ØŒ Ø¯Ø±ÙˆØ³ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ø³ØªÙ†Ø¯</p>
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ Ø®Ø·Ø§ -->
        <div class="page" id="errorPage">
            <div class="error-section">
                <div class="error-icon">âš ï¸</div>
                <h1 class="error-title">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h1>
                <p class="error-desc">
                    Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ù†ØªÙˆØ§Ù†Ø³ØªÛŒÙ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒÙ….<br>
                    Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ØµØ­ÛŒØ­ Ø§Ø³Øª.
                </p>
                
                <div class="error-details">
                    <h4>Ø³Ø§Ø®ØªØ§Ø± ØµØ­ÛŒØ­ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:</h4>
                    <ul>
                        <li>ÙØ§ÛŒÙ„ <strong>words.txt</strong> Ø¯Ø± Ú©Ù†Ø§Ø± ÙØ§ÛŒÙ„ HTML</li>
                        <li>Ù¾ÙˆØ´Ù‡ <strong>sounds</strong> Ø´Ø§Ù…Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ MP3</li>
                        <li>Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ: dars1_1.mp3, dars1_2.mp3 Ùˆ ...</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ ÙÙ‡Ø±Ø³Øª -->
        <div class="page" id="menuPage">
            <div class="header">
                <div class="emoji-decoration">ğŸ“šâœ¨ğŸ“</div>
                <h1 class="main-title">Ø¯ÛŒÚ©ØªÙ‡â€ŒÚ¯ÙˆÛŒ ÙØ§Ø±Ø³ÛŒ</h1>
                <p class="subtitle">Ù¾Ø§ÛŒÙ‡ Ú†Ù‡Ø§Ø±Ù… Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ</p>
                <div class="emoji-decoration">ğŸ¨ğŸŒŸğŸ¯</div>
            </div>

            <div class="lesson-grid" id="lessonGrid"></div>
        </div>

        <!-- ØµÙØ­Ù‡ Ø¯ÛŒÚ©ØªÙ‡ -->
        <div class="page" id="dictationPage">
            <div class="lesson-header">
                <h2 id="lessonTitle"></h2>
                <div class="lesson-number" id="lessonSubtitle"></div>
            </div>

            <div class="repeat-selector">
                <label for="repeatCount">ğŸ” ØªØ¹Ø¯Ø§Ø¯ ØªÚ©Ø±Ø§Ø± Ù‡Ø± Ø¹Ø¨Ø§Ø±Øª:</label>
                <select id="repeatCount" onchange="changeRepeatCount()">
                    <option value="1">Û± Ø¨Ø§Ø±</option>
                    <option value="2">Û² Ø¨Ø§Ø±</option>
                    <option value="3" selected>Û³ Ø¨Ø§Ø±</option>
                    <option value="4">Û´ Ø¨Ø§Ø±</option>
                    <option value="5">Ûµ Ø¨Ø§Ø±</option>
                </select>
            </div>

            <div class="progress-container">
                <div class="progress-label">Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³ ğŸ“Š</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar">0%</div>
                </div>
            </div>

            <div class="repeat-info" id="repeatInfo"></div>

            <div class="listening-indicator">
                <div class="listening-emoji">ğŸ‘‚</div>
                <div class="listening-text">Ø¨Ø§ Ø¯Ù‚Øª Ú¯ÙˆØ´ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯</div>
            </div>

            <div class="controls-section">
                <div class="controls-title">ğŸ® Ú©Ù†ØªØ±Ù„ Ù¾Ø®Ø´</div>
                <div class="main-controls">
                    <button class="control-btn btn-first" onclick="goToFirst()">â®ï¸ Ø§ÙˆÙ„ÛŒÙ†</button>
                    <button class="control-btn btn-prev" onclick="previousPhrase()">âª Ù‚Ø¨Ù„ÛŒ</button>
                    <button class="control-btn btn-play" id="playBtn" onclick="playPause()">â–¶ï¸ Ù¾Ø®Ø´</button>
                    <button class="control-btn btn-next" onclick="nextPhrase()">â© Ø¨Ø¹Ø¯ÛŒ</button>
                    <button class="control-btn btn-last" onclick="goToLast()">â­ï¸ Ø¢Ø®Ø±ÛŒÙ†</button>
                </div>

                <div class="navigation-controls">
                    <button class="control-btn btn-flashcard" onclick="showPage('flashcardPage')">ğŸ’¡ ÙÙ„Ø´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</button>
                    <button class="control-btn btn-menu" onclick="backToMenu()">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                </div>
            </div>

            <div class="volume-section">
                <div class="volume-control">
                    <div class="volume-icon">ğŸ”Š</div>
                    <input type="range" min="0" max="100" value="80" class="volume-slider" id="volumeSlider" oninput="updateVolume()">
                    <div class="volume-value" id="volumeValue">80%</div>
                </div>
            </div>

            <div class="status-message info" id="statusMessage">
                Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø®Ø´ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯! ğŸµ
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ ÙÙ„Ø´ Ú©Ø§Ø±Øª -->
        <div class="page" id="flashcardPage">
            <div class="flashcard-header">
                <h2>ğŸ’¡ Ú©Ù„Ù…Ø§Øª Ù…Ù‡Ù… Ø§Ù…Ù„Ø§ÛŒÛŒ</h2>
                <p class="lesson-number" id="flashcardTitle"></p>
            </div>

            <div class="flashcard-grid" id="flashcardGrid"></div>

            <button class="back-btn" onclick="showPage('dictationPage')">
                â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯ÛŒÚ©ØªÙ‡
            </button>
        </div>
    </div>

    <script>
        let lessons = [];
        let currentLessonIndex = 0;
        let currentPhraseIndex = 0;
        let currentRepeat = 1;
        let maxRepeats = 3;
        let isPlaying = false;
        let currentAudio = null;
        let volume = 0.8;

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø´Ø±ÙˆØ¹
        window.addEventListener('DOMContentLoaded', () => {
            loadWordsFile();
        });

        async function loadWordsFile() {
            try {
                const response = await fetch('words.txt');
                if (!response.ok) throw new Error('ÙØ§ÛŒÙ„ words.txt Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯');
                
                const text = await response.text();
                parseWordsFile(text);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', error);
                showError();
            }
        }

        function parseWordsFile(text) {
            lessons = [];
            const lines = text.split('\n');
            let currentLesson = null;
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                if (line.startsWith('[') && line.endsWith(']')) {
                    const lessonName = line.substring(1, line.length - 1);
                    currentLesson = {
                        name: lessonName,
                        keywords: []
                    };
                    lessons.push(currentLesson);
                } else if (currentLesson) {
                    currentLesson.keywords.push(line);
                }
            }
            
            if (lessons.length > 0) {
                detectAudioFiles();
            } else {
                showError();
            }
        }

        async function detectAudioFiles() {
            // Ø´Ù…Ø§Ø±Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ Ù‡Ø± Ø¯Ø±Ø³
            for (let i = 0; i < lessons.length; i++) {
                let count = 0;
                for (let j = 1; j <= 100; j++) {
                    const audioFile = `sounds/dars${i + 1}_${j}.mp3`;
                    try {
                        const response = await fetch(audioFile, { method: 'HEAD' });
                        if (response.ok) {
                            count++;
                        } else {
                            break;
                        }
                    } catch {
                        break;
                    }
                }
                lessons[i].audioCount = count;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ ÙÙ‡Ø±Ø³Øª
            renderLessons();
            showPage('menuPage');
        }

        function renderLessons() {
            const grid = document.getElementById('lessonGrid');
            grid.innerHTML = '';
            
            const icons = ['ğŸ“˜', 'ğŸ“—', 'ğŸ“™', 'ğŸ“•', 'ğŸ“”', 'ğŸ““', 'ğŸ“’', 'ğŸ“–'];
            
            lessons.forEach((lesson, index) => {
                const card = document.createElement('div');
                card.className = 'lesson-card';
                card.onclick = () => startLesson(index);
                card.innerHTML = `
                    <div class="lesson-icon">${icons[index % icons.length]}</div>
                    <div class="lesson-title">Ø§Ù…Ù„Ø§ÛŒ ${lesson.name}</div>
                    <div class="lesson-desc">${toPersianNum(lesson.audioCount)} Ø¹Ø¨Ø§Ø±Øª</div>
                `;
                grid.appendChild(card);
            });
        }

        function startLesson(index) {
            const lesson = lessons[index];
            
            if (lesson.audioCount === 0) {
                alert('âš ï¸ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø±Ø³ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!');
                return;
            }
            
            currentLessonIndex = index;
            currentPhraseIndex = 0;
            currentRepeat = 1;
            isPlaying = false;
            
            document.getElementById('lessonTitle').textContent = 'Ø§Ù…Ù„Ø§ÛŒ ' + lesson.name;
            document.getElementById('lessonSubtitle').textContent = toPersianNum(lesson.audioCount) + ' Ø¹Ø¨Ø§Ø±Øª';
            
            updateDisplay();
            showPage('dictationPage');
            showStatus('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø®Ø´ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯! ğŸµ', 'info');
        }

        function changeRepeatCount() {
            maxRepeats = parseInt(document.getElementById('repeatCount').value);
            if (currentRepeat > maxRepeats) {
                currentRepeat = maxRepeats;
            }
            updateDisplay();
        }

        function playAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            const audioFile = `sounds/dars${currentLessonIndex + 1}_${currentPhraseIndex + 1}.mp3`;
            currentAudio = new Audio(audioFile);
            currentAudio.volume = volume;
            
            currentAudio.onerror = () => {
                showStatus('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø®Ø´ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ', 'error');
                isPlaying = false;
                document.getElementById('playBtn').innerHTML = 'â–¶ï¸ Ù¾Ø®Ø´';
            };
            
            currentAudio.onended = () => {
                if (!isPlaying) return;
                
                if (currentRepeat < maxRepeats) {
                    currentRepeat++;
                    updateDisplay();
                    setTimeout(() => {
                        if (isPlaying) playAudio();
                    }, 1500);
                } else {
                    const lesson = lessons[currentLessonIndex];
                    if (currentPhraseIndex + 1 < lesson.audioCount) {
                        setTimeout(() => {
                            if (isPlaying) {
                                currentPhraseIndex++;
                                currentRepeat = 1;
                                updateDisplay();
                                playAudio();
                            }
                        }, 2500);
                    } else {
                        finishDictation();
                    }
                }
            };
            
            currentAudio.play();
        }

        function playPause() {
            if (!isPlaying) {
                isPlaying = true;
                document.getElementById('playBtn').innerHTML = 'â¸ï¸ ØªÙˆÙ‚Ù';
                showStatus('Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´... ğŸµ', 'info');
                playAudio();
            } else {
                isPlaying = false;
                if (currentAudio) currentAudio.pause();
                document.getElementById('playBtn').innerHTML = 'â–¶ï¸ Ù¾Ø®Ø´';
                showStatus('Ù…ØªÙˆÙ‚Ù Ø´Ø¯ â¸ï¸', 'warning');
            }
        }

        function previousPhrase() {
            if (currentPhraseIndex > 0) {
                const wasPlaying = isPlaying;
                stopPlayback();
                currentPhraseIndex--;
                currentRepeat = 1;
                updateDisplay();
                showStatus('Ø¹Ø¨Ø§Ø±Øª Ù‚Ø¨Ù„ÛŒ âª', 'info');
                
                if (wasPlaying) {
                    setTimeout(() => {
                        isPlaying = true;
                        document.getElementById('playBtn').innerHTML = 'â¸ï¸ ØªÙˆÙ‚Ù';
                        playAudio();
                    }, 500);
                }
            }
        }

        function nextPhrase() {
            const lesson = lessons[currentLessonIndex];
            if (currentPhraseIndex + 1 < lesson.audioCount) {
                const wasPlaying = isPlaying;
                stopPlayback();
                currentPhraseIndex++;
                currentRepeat = 1;
                updateDisplay();
                showStatus('Ø¹Ø¨Ø§Ø±Øª Ø¨Ø¹Ø¯ÛŒ â©', 'info');
                
                if (wasPlaying) {
                    setTimeout(() => {
                        isPlaying = true;
                        document.getElementById('playBtn').innerHTML = 'â¸ï¸ ØªÙˆÙ‚Ù';
                        playAudio();
                    }, 500);
                }
            } else {
                showStatus('âš ï¸ Ø§ÛŒÙ† Ø¢Ø®Ø±ÛŒÙ† Ø¹Ø¨Ø§Ø±Øª Ø§Ø³Øª', 'warning');
            }
        }

        function goToFirst() {
            const wasPlaying = isPlaying;
            stopPlayback();
            currentPhraseIndex = 0;
            currentRepeat = 1;
            updateDisplay();
            showStatus('Ø§ÙˆÙ„ÛŒÙ† Ø¹Ø¨Ø§Ø±Øª â®ï¸', 'info');
            
            if (wasPlaying) {
                setTimeout(() => {
                    isPlaying = true;
                    document.getElementById('playBtn').innerHTML = 'â¸ï¸ ØªÙˆÙ‚Ù';
                    playAudio();
                }, 500);
            }
        }

        function goToLast() {
            const lesson = lessons[currentLessonIndex];
            const wasPlaying = isPlaying;
            stopPlayback();
            currentPhraseIndex = lesson.audioCount - 1;
            currentRepeat = 1;
            updateDisplay();
            showStatus('Ø¢Ø®Ø±ÛŒÙ† Ø¹Ø¨Ø§Ø±Øª â­ï¸', 'info');
            
            if (wasPlaying) {
                setTimeout(() => {
                    isPlaying = true;
                    document.getElementById('playBtn').innerHTML = 'â¸ï¸ ØªÙˆÙ‚Ù';
                    playAudio();
                }, 500);
            }
        }

        function stopPlayback() {
            isPlaying = false;
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            document.getElementById('playBtn').innerHTML = 'â–¶ï¸ Ù¾Ø®Ø´';
        }

        function updateDisplay() {
            const lesson = lessons[currentLessonIndex];
            const totalCount = lesson.audioCount;
            
            const progress = ((currentPhraseIndex + 1) / totalCount) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = Math.round(progress) + '%';
            
            const repeatText = `ØªÚ©Ø±Ø§Ø±: ${toPersianNum(currentRepeat)} Ø§Ø² ${toPersianNum(maxRepeats)}`;
            const phraseText = `Ø¹Ø¨Ø§Ø±Øª: ${toPersianNum(currentPhraseIndex + 1)} Ø§Ø² ${toPersianNum(totalCount)}`;
            document.getElementById('repeatInfo').textContent = repeatText + ' | ' + phraseText;
        }

        function updateVolume() {
            const slider = document.getElementById('volumeSlider');
            volume = slider.value / 100;
            document.getElementById('volumeValue').textContent = slider.value + '%';
            if (currentAudio) currentAudio.volume = volume;
        }

        function showFlashcards() {
            const lesson = lessons[currentLessonIndex];
            document.getElementById('flashcardTitle').textContent = lesson.name;
            
            const grid = document.getElementById('flashcardGrid');
            grid.innerHTML = '';
            
            lesson.keywords.forEach(keyword => {
                const card = document.createElement('div');
                card.className = 'flashcard';
                card.textContent = keyword;
                card.onclick = () => speakWord(keyword);
                grid.appendChild(card);
            });
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'fa-IR';
                utterance.rate = 0.8;
                utterance.volume = volume;
                speechSynthesis.speak(utterance);
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if (pageId === 'flashcardPage') {
                showFlashcards();
            }
        }

        function backToMenu() {
            stopPlayback();
            showPage('menuPage');
        }

        function finishDictation() {
            isPlaying = false;
            document.getElementById('playBtn').innerHTML = 'âœ… ØªÙ…Ø§Ù… Ø´Ø¯';
            showStatus('ğŸ‰ Ø¢ÙØ±ÛŒÙ†! Ø¯ÛŒÚ©ØªÙ‡ ØªÙ…Ø§Ù… Ø´Ø¯!', 'success');
        }

        function showStatus(message, type) {
            const status = document.getElementById('statusMessage');
            status.textContent = message;
            status.className = 'status-message ' + type;
        }

        function showError() {
            showPage('errorPage');
        }

        function toPersianNum(num) {
            return num.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
        }
    </script>
</body>
</html>